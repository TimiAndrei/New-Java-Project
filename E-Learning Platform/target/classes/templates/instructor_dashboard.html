<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>Instructor Dashboard - E-Learning Platform</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">E-Learning</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="/courses">Courses</a></li>
          <li class="nav-item"><a class="nav-link" href="/quizzes">Quizzes</a></li>
          <li class="nav-item"><a class="nav-link" href="/enrollments">Enrollments</a></li>
          <li class="nav-item"><a class="nav-link" href="/users">Users</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container">
    <h2>Instructor Dashboard</h2>
    <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#createCourseModal">Create New Course</button>
    <h3>Your Courses</h3>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Title</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="course : ${instructorCourses}">
          <td th:text="${course.title}"></td>
          <td>
            <button class="btn btn-warning btn-sm" th:attr="data-id=${course.id}" onclick="openEditCourseModal(this)">Edit</button>
            <button class="btn btn-danger btn-sm" th:attr="data-id=${course.id}" onclick="openDeleteCourseModal(this)">Delete</button>
            <button class="btn btn-info btn-sm" th:attr="data-id=${course.id}" onclick="openManageLessonsModal(this)">Manage Lessons</button>
            <button class="btn btn-primary btn-sm" th:attr="data-id=${course.id}" onclick="openManageQuizzesModal(this)">Manage Quizzes</button>
            <button class="btn btn-success btn-sm" th:attr="data-id=${course.id}" onclick="openCreateLessonModal(this)">Add Lesson</button>
            <button class="btn btn-warning btn-sm" th:attr="data-id=${course.id}" onclick="openCreateQuizModal(this)">Add Quiz</button>
            <!-- Create Lesson Modal -->
            <div class="modal fade" id="createLessonModal" tabindex="-1" aria-labelledby="createLessonModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="createLessonModalLabel">Create New Lesson</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <form id="createLessonForm">
                      <input type="hidden" id="lessonCourseId" name="courseId">
                      <div class="mb-3">
                        <label for="lessonTitle" class="form-label">Title</label>
                        <input type="text" class="form-control" id="lessonTitle" name="title" required>
                      </div>
                      <div class="mb-3">
                        <label for="lessonContent" class="form-label">Content</label>
                        <textarea class="form-control" id="lessonContent" name="content" required></textarea>
                      </div>
                      <div class="mb-3">
                        <label for="lessonOrder" class="form-label">Order</label>
                        <input type="number" class="form-control" id="lessonOrder" name="lessonOrder" required>
                      </div>
                      <button type="submit" class="btn btn-success">Create Lesson</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>

            <!-- Create Quiz Modal -->
            <div class="modal fade" id="createQuizModal" tabindex="-1" aria-labelledby="createQuizModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="createQuizModalLabel">Create New Quiz</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <form id="createQuizForm">
                      <input type="hidden" id="quizCourseId" name="courseId">
                      <div class="mb-3">
                        <label for="quizTitle" class="form-label">Quiz Title</label>
                        <input type="text" class="form-control" id="quizTitle" name="title" required>
                      </div>
                      <div class="mb-3">
                        <label for="quizLessonId" class="form-label">Lesson ID</label>
                        <input type="number" class="form-control" id="quizLessonId" name="lessonId" required>
                      </div>
                      <button type="submit" class="btn btn-success">Create Quiz</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            // LESSON MODAL LOGIC
            function openCreateLessonModal(btn) {
            document.getElementById('lessonCourseId').value = btn.getAttribute('data-id');
            var modal = new bootstrap.Modal(document.getElementById('createLessonModal'));
            modal.show();
            }
            document.getElementById('createLessonForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = {
            courseId: document.getElementById('lessonCourseId').value,
            title: document.getElementById('lessonTitle').value,
            content: document.getElementById('lessonContent').value,
            lessonOrder: document.getElementById('lessonOrder').value
            };
            fetch('/api/lessons', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
            })
            .then(response => {
            if (response.ok) {
            location.reload();
            } else {
            response.text().then(text => alert('Failed to create lesson: ' + text));
            }
            })
            .catch(error => alert('Error: ' + error));
            });

            // QUIZ MODAL LOGIC
            function openCreateQuizModal(btn) {
            document.getElementById('quizCourseId').value = btn.getAttribute('data-id');
            var modal = new bootstrap.Modal(document.getElementById('createQuizModal'));
            modal.show();
            }
            document.getElementById('createQuizForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = {
            title: document.getElementById('quizTitle').value,
            lessonId: document.getElementById('quizLessonId').value
            };
            fetch('/api/quizzes', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
            })
            .then(response => {
            if (response.ok) {
            location.reload();
            } else {
            response.text().then(text => alert('Failed to create quiz: ' + text));
            }
            })
            .catch(error => alert('Error: ' + error));
            });
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Create Course Modal -->
    <div class="modal fade" id="createCourseModal" tabindex="-1" aria-labelledby="createCourseModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="createCourseModalLabel">Create New Course</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="createCourseForm">
              <div class="mb-3">
                <label for="courseTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="courseTitle" name="title" required>
              </div>
              <div class="mb-3">
                <label for="courseDescription" class="form-label">Description</label>
                <textarea class="form-control" id="courseDescription" name="description" required></textarea>
              </div>
              <div class="mb-3">
                <label for="courseDifficulty" class="form-label">Difficulty</label>
                <input type="text" class="form-control" id="courseDifficulty" name="difficulty" required>
              </div>
              <div class="mb-3">
                <label for="courseCategory" class="form-label">Category</label>
                <input type="text" class="form-control" id="courseCategory" name="category" required>
              </div>
              <button type="submit" class="btn btn-success">Create</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Course Modal -->
    <div class="modal fade" id="editCourseModal" tabindex="-1" aria-labelledby="editCourseModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editCourseModalLabel">Edit Course</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="editCourseForm">
              <input type="hidden" id="editCourseId" name="id">
              <div class="mb-3">
                <label for="editCourseTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="editCourseTitle" name="title" required>
              </div>
              <div class="mb-3">
                <label for="editCourseDescription" class="form-label">Description</label>
                <textarea class="form-control" id="editCourseDescription" name="description" required></textarea>
              </div>
              <div class="mb-3">
                <label for="editCourseDifficulty" class="form-label">Difficulty</label>
                <input type="text" class="form-control" id="editCourseDifficulty" name="difficulty" required>
              </div>
              <div class="mb-3">
                <label for="editCourseCategory" class="form-label">Category</label>
                <input type="text" class="form-control" id="editCourseCategory" name="category" required>
              </div>
              <button type="submit" class="btn btn-warning">Save Changes</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- Delete Course Modal -->
    <div class="modal fade" id="deleteCourseModal" tabindex="-1" aria-labelledby="deleteCourseModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteCourseModalLabel">Delete Course</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to delete this course?</p>
            <button id="confirmDeleteCourseBtn" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Edit Lesson Modal -->
    <div class="modal fade" id="editLessonModal" tabindex="-1" aria-labelledby="editLessonModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editLessonModalLabel">Edit Lesson</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="editLessonForm">
              <input type="hidden" id="editLessonId" name="id">
              <div class="mb-3">
                <label for="editLessonTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="editLessonTitle" name="title" required>
              </div>
              <div class="mb-3">
                <label for="editLessonContent" class="form-label">Content</label>
                <textarea class="form-control" id="editLessonContent" name="content" required></textarea>
              </div>
              <div class="mb-3">
                <label for="editLessonOrder" class="form-label">Order</label>
                <input type="number" class="form-control" id="editLessonOrder" name="lessonOrder" required>
              </div>
              <button type="submit" class="btn btn-warning">Save Changes</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- Delete Lesson Modal -->
    <div class="modal fade" id="deleteLessonModal" tabindex="-1" aria-labelledby="deleteLessonModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteLessonModalLabel">Delete Lesson</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to delete this lesson?</p>
            <button id="confirmDeleteLessonBtn" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Edit Quiz Modal -->
    <div class="modal fade" id="editQuizModal" tabindex="-1" aria-labelledby="editQuizModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editQuizModalLabel">Edit Quiz</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="editQuizForm">
              <input type="hidden" id="editQuizId" name="id">
              <div class="mb-3">
                <label for="editQuizTitle" class="form-label">Quiz Title</label>
                <input type="text" class="form-control" id="editQuizTitle" name="title" required>
              </div>
              <div class="mb-3">
                <label for="editQuizLessonId" class="form-label">Lesson ID</label>
                <input type="number" class="form-control" id="editQuizLessonId" name="lessonId" required>
              </div>
              <button type="submit" class="btn btn-warning">Save Changes</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- Delete Quiz Modal -->
    <div class="modal fade" id="deleteQuizModal" tabindex="-1" aria-labelledby="deleteQuizModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteQuizModalLabel">Delete Quiz</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to delete this quiz?</p>
            <button id="confirmDeleteQuizBtn" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </div>
    </div>
    // EDIT/DELETE COURSE
    function openEditCourseModal(btn) {
    const courseId = btn.getAttribute('data-id');
    fetch(`/api/courses/${courseId}`)
    .then(res => res.json())
    .then(course => {
    document.getElementById('editCourseId').value = course.id;
    document.getElementById('editCourseTitle').value = course.title;
    document.getElementById('editCourseDescription').value = course.description;
    document.getElementById('editCourseDifficulty').value = course.difficulty;
    document.getElementById('editCourseCategory').value = course.category;
    new bootstrap.Modal(document.getElementById('editCourseModal')).show();
    });
    }
    document.getElementById('editCourseForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const id = document.getElementById('editCourseId').value;
    const data = {
    title: document.getElementById('editCourseTitle').value,
    description: document.getElementById('editCourseDescription').value,
    difficulty: document.getElementById('editCourseDifficulty').value,
    category: document.getElementById('editCourseCategory').value
    };
    fetch(`/api/courses/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
    })
    .then(response => {
    if (response.ok) {
    location.reload();
    } else {
    response.text().then(text => alert('Failed to update course: ' + text));
    }
    });
    });
    function openDeleteCourseModal(btn) {
    const courseId = btn.getAttribute('data-id');
    document.getElementById('confirmDeleteCourseBtn').onclick = function() {
    fetch(`/api/courses/${courseId}`, { method: 'DELETE' })
    .then(response => {
    if (response.ok) {
    location.reload();
    } else {
    response.text().then(text => alert('Failed to delete course: ' + text));
    }
    });
    };
    new bootstrap.Modal(document.getElementById('deleteCourseModal')).show();
    }

    // EDIT/DELETE LESSON
    function openEditLessonModal(lessonId) {
    fetch(`/lessons/${lessonId}`)
    .then(res => res.json())
    .then(lesson => {
    document.getElementById('editLessonId').value = lesson.id;
    document.getElementById('editLessonTitle').value = lesson.title;
    document.getElementById('editLessonContent').value = lesson.content;
    document.getElementById('editLessonOrder').value = lesson.lessonOrder;
    new bootstrap.Modal(document.getElementById('editLessonModal')).show();
    });
    }
    document.getElementById('editLessonForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const id = document.getElementById('editLessonId').value;
    const data = {
    title: document.getElementById('editLessonTitle').value,
    content: document.getElementById('editLessonContent').value,
    lessonOrder: document.getElementById('editLessonOrder').value
    };
    fetch(`/lessons/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
    })
    .then(response => {
    if (response.ok) {
    location.reload();
    } else {
    response.text().then(text => alert('Failed to update lesson: ' + text));
    }
    });
    });
    function openDeleteLessonModal(lessonId) {
    document.getElementById('confirmDeleteLessonBtn').onclick = function() {
    fetch(`/lessons/${lessonId}`, { method: 'DELETE' })
    .then(response => {
    if (response.ok) {
    location.reload();
    } else {
    response.text().then(text => alert('Failed to delete lesson: ' + text));
    }
    });
    };
    new bootstrap.Modal(document.getElementById('deleteLessonModal')).show();
    }

    // EDIT/DELETE QUIZ
    function openEditQuizModal(quizId) {
    fetch(`/api/quizzes/${quizId}`)
    .then(res => res.json())
    .then(quiz => {
    document.getElementById('editQuizId').value = quiz.id;
    document.getElementById('editQuizTitle').value = quiz.title;
    document.getElementById('editQuizLessonId').value = quiz.lessonId;
    new bootstrap.Modal(document.getElementById('editQuizModal')).show();
    });
    }
    document.getElementById('editQuizForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const id = document.getElementById('editQuizId').value;
    const data = {
    title: document.getElementById('editQuizTitle').value,
    lessonId: document.getElementById('editQuizLessonId').value
    };
    fetch(`/api/quizzes/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
    })
    .then(response => {
    if (response.ok) {
    location.reload();
    } else {
    response.text().then(text => alert('Failed to update quiz: ' + text));
    }
    });
    });
    function openDeleteQuizModal(quizId) {
    document.getElementById('confirmDeleteQuizBtn').onclick = function() {
    fetch(`/api/quizzes/${quizId}`, { method: 'DELETE' })
    .then(response => {
    if (response.ok) {
    location.reload();
    } else {
    response.text().then(text => alert('Failed to delete quiz: ' + text));
    }
    });
    };
    new bootstrap.Modal(document.getElementById('deleteQuizModal')).show();
    }
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById('createCourseForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const data = {
        title: document.getElementById('courseTitle').value,
        description: document.getElementById('courseDescription').value,
        difficulty: document.getElementById('courseDifficulty').value,
        category: document.getElementById('courseCategory').value
      };
      fetch('/api/courses', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => {
          if (response.ok) {
            location.reload();
          } else {
            response.text().then(text => alert('Failed to create course: ' + text));
          }
        })
        .catch(error => alert('Error: ' + error));
    });

    function openEditCourseModal(btn) {
      // TODO: Load course data and show in modal
      var modal = new bootstrap.Modal(document.getElementById('editCourseModal'));
      modal.show();
    }

    function openDeleteCourseModal(btn) {
      // TODO: Show delete confirmation
      var modal = new bootstrap.Modal(document.getElementById('deleteCourseModal'));
      modal.show();
    }

    function openManageLessonsModal(btn) {
      // TODO: Load lessons management UI
      var modal = new bootstrap.Modal(document.getElementById('manageLessonsModal'));
      modal.show();
    }

    function openManageQuizzesModal(btn) {
      // TODO: Load quizzes management UI
      var modal = new bootstrap.Modal(document.getElementById('manageQuizzesModal'));
      modal.show();
    }
  </script>
</body>

</html>